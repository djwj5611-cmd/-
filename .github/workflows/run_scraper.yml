# íŒŒì¼ ê²½ë¡œ: .github/workflows/run_scraper.yml

name: Run Daily Trend Scraper

on:
  # "Actions" íƒ­ì—ì„œ ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©
  workflow_dispatch:
  # ë§¤ì¼ ì•„ì¹¨ 9ì‹œ(KST)ì— ìë™ìœ¼ë¡œ ì‹¤í–‰
  schedule:
    - cron: '0 0 * * *'

# ë™ì‹œ ì‹¤í–‰ìœ¼ë¡œ ì¸í•œ ì¶©ëŒ ë°©ì§€
concurrency:
  group: ${{ github.workflow }}
  cancel-in-progress: true

jobs:
  scrape:
    runs-on: ubuntu-latest

    # ì €ì¥ì†Œì— ì“°ê¸° ê¶Œí•œ ë¶€ì—¬
    permissions:
      contents: write

    steps:
      # 1. ì €ì¥ì†Œ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. íŒŒì´ì¬ í™˜ê²½ ì„¤ì •
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 3. í•„ìš”í•œ ëª¨ë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
      - name: Install dependencies
        run: pip install -r requirements.txt

      # 4. íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
      - name: Run the scraper script
        run: python trend_collector.py

      # 5. EndBugì˜ ì „ë¬¸í™”ëœ Actionì„ ì‚¬ìš©í•˜ì—¬ ì•ˆì „í•˜ê²Œ ì»¤ë°‹ ë° í‘¸ì‹œ
      # ì´ê²ƒì´ stefanzweifelì„ ëŒ€ì²´í•˜ëŠ” ìƒˆë¡œìš´ ë¡œë´‡ì…ë‹ˆë‹¤.
      - name: Commit and push the report
        uses: EndBug/add-and-commit@v9
        with:
          # ì»¤ë°‹ ë©”ì‹œì§€
          message: 'ğŸ“Š Update daily trend report'
          # ì¶”ê°€í•  íŒŒì¼ íŒ¨í„´
          add: 'reports/*.txt'
          # ì»¤ë°‹ ì‘ì„±ì ì •ë³´ (github-actions ë´‡ìœ¼ë¡œ í†µì¼)
          default_author: github_actions
          # ê°€ì¥ ì¤‘ìš”: force-with-leaseë¡œ ì•ˆì „í•˜ê²Œ ê°•ì œ í‘¸ì‹œí•˜ì—¬ ì¶©ëŒ í•´ê²°
          push: '--force-with-lease'